{% extends "base.html" %}

{% block title %}Add Trip - Travel Tracker{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card">
            <div class="card-header">
                <h3 class="mb-0">
                    <i class="fas fa-plus-circle me-2"></i>Add New Trip
                </h3>
            </div>
            <div class="card-body">
                <form method="POST" id="tripForm">
                    <!-- Trip Basic Information -->
                    <div class="card mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="fas fa-map-marked-alt me-2"></i>Trip Information</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="destination" class="form-label">
                                    <i class="fas fa-map-marker-alt me-1"></i>Destination
                                </label>
                                <input type="text" class="form-control" id="destination" name="destination" required>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="start_date" class="form-label">
                                            <i class="fas fa-calendar-alt me-1"></i>Start Date
                                        </label>
                                        <input type="date" class="form-control" id="start_date" name="start_date" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="end_date" class="form-label">
                                            <i class="fas fa-calendar-check me-1"></i>End Date
                                        </label>
                                        <input type="date" class="form-control" id="end_date" name="end_date" required>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="description" class="form-label">
                                    <i class="fas fa-sticky-note me-1"></i>Description (optional)
                                </label>
                                <textarea class="form-control" id="description" name="description" rows="3" 
                                          placeholder="Describe your trip..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Dynamic Blocks Container -->
                    <div class="card mb-4">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0"><i class="fas fa-list me-2"></i>Trip Details</h5>
                        </div>
                        <div class="card-body" id="dynamicBlocks">
                            <div class="text-center text-muted py-4" id="emptyState">
                                <i class="fas fa-list fa-3x mb-3"></i>
                                <h6>No details added yet</h6>
                                <p>Use the buttons below to add accommodations or travels to your trip</p>
                            </div>
                        </div>
                        <div class="card-footer text-center bg-light">
                            <div class="btn-group">
                                <button type="button" class="btn btn-info" onclick="addBlock('accommodation')">
                                    <i class="fas fa-bed me-1"></i>Add Accommodation
                                </button>
                                <button type="button" class="btn btn-warning" onclick="addBlock('travel')">
                                    <i class="fas fa-plane me-1"></i>Add Travel
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('main.index') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-1"></i>Back
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>Save Trip
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Templates for dynamic blocks -->
<div id="blockTemplates" style="display: none;">
    <!-- Accommodation Template -->
    <div id="accommodationTemplate" class="card mb-3 block-item">
        <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
            <h6 class="mb-0"><i class="fas fa-bed me-2"></i>Accommodation</h6>
            <button type="button" class="btn btn-sm btn-outline-light" onclick="removeBlock(this)">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Location</label>
                        <input type="text" class="form-control" name="accommodations[INDEX][location]" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Price</label>
                        <input type="number" step="0.01" class="form-control" name="accommodations[INDEX][price]" required>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">Check-in</label>
                        <input type="date" class="form-control" name="accommodations[INDEX][check_in]" required>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">Check-out</label>
                        <input type="date" class="form-control" name="accommodations[INDEX][check_out]" required>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">Standard</label>
                        <select class="form-control" name="accommodations[INDEX][standard]">
                            <option value="">Select standard</option>
                            <option value="Budget">Budget</option>
                            <option value="Standard">Standard</option>
                            <option value="Premium">Premium</option>
                            <option value="Luxury">Luxury</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="mb-3">
                        <label class="form-label">
                            <i class="fas fa-link me-1"></i>Link (optional)
                        </label>
                        <input type="url" class="form-control" name="accommodations[INDEX][link]" 
                               placeholder="https://booking.com/hotel/... or hotel website">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Travel Template -->
    <div id="travelTemplate" class="card mb-3 block-item">
        <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
            <h6 class="mb-0"><i class="fas fa-plane me-2"></i>Travel</h6>
            <button type="button" class="btn btn-sm btn-outline-dark" onclick="removeBlock(this)">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">From Location</label>
                        <input type="text" class="form-control" name="travels[INDEX][from_location]" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">To Location</label>
                        <input type="text" class="form-control" name="travels[INDEX][to_location]" required>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">Start Date</label>
                        <input type="date" class="form-control" name="travels[INDEX][start_date]" required>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">End Date</label>
                        <input type="date" class="form-control" name="travels[INDEX][end_date]" required>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">Price</label>
                        <input type="number" step="0.01" class="form-control" name="travels[INDEX][price]" required>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let blockIndex = 0;

function addBlock(type) {
    const container = document.getElementById('dynamicBlocks');
    const emptyState = document.getElementById('emptyState');
    
    // Hide empty state
    if (emptyState) {
        emptyState.style.display = 'none';
    }
    
    // Get template
    const template = document.getElementById(type + 'Template').cloneNode(true);
    template.id = type + '_' + blockIndex;
    
    // Replace INDEX placeholder with actual index
    template.innerHTML = template.innerHTML.replace(/INDEX/g, blockIndex);
    
    // Add to container
    container.appendChild(template);
    
    blockIndex++;
}

function removeBlock(button) {
    const block = button.closest('.block-item');
    block.remove();
    
    // Show empty state if no blocks
    const container = document.getElementById('dynamicBlocks');
    const blocks = container.querySelectorAll('.block-item');
    const emptyState = document.getElementById('emptyState');
    
    if (blocks.length === 0 && emptyState) {
        emptyState.style.display = 'block';
    }
}

// Form validation
document.getElementById('tripForm').addEventListener('submit', function(e) {
    const startDate = new Date(document.getElementById('start_date').value);
    const endDate = new Date(document.getElementById('end_date').value);
    
    if (startDate > endDate) {
        e.preventDefault();
        alert('End date cannot be earlier than start date!');
        return false;
    }
});
</script>

<style>
.block-item {
    border-left: 4px solid #007bff;
}

.dropdown-item:hover {
    background-color: #f8f9fa;
}

.card-header .btn {
    transition: all 0.2s ease;
}

.card-header .btn:hover {
    transform: translateY(-1px);
}

#emptyState {
    transition: all 0.3s ease;
}
</style>
{% endblock %}
